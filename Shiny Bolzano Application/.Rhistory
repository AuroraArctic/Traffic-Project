m <- mongo("Predictions", url = "mongodb+srv://root:BigData@cluster0.oc5hq.mongodb.net/TrafficBolzano")
m <- mongo(collection = "Predictions",
db = 'TrafficBolzano',
url = "mongodb+srv://root:BigData@cluster0.oc5hq.mongodb.net/test")
m$find()
latest_predictions = m$find(sort = '{timestamp:-1}')
latest_predictions = m$find(sort = '{"timestamp":-1}')
latest_predictions
latest_predictions$timestamp[1]
latest_predictions = m$find(sort = '{"timestamp":-1}', limit=1)
latest_timestamp = latest_predictions$timestamp[1]
latest_timestamp
paste0('{"timestamp":',latest_timestamp,'}')
latest_data = m$find(paste0('{"timestamp":',latest_timestamp,'}'))
latest_data = m$find(paste0('{"timestamp":"',latest_timestamp,'"}'))
latest_data
# Connection to DB
source("mysql_connection.R")
mongo_con <- mongodbconnect()
mongo_db <- mongodbconnect()
# Connection to DB
source("mysql_connection.R")
mongo_db <- mongodbconnect()
latest_timestamp = m$find(sort = '{"timestamp":-1}', limit=1)$timestamp[1]
latest_data = m$find(paste0('{"timestamp":"',latest_timestamp,'"}')) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
mongo_db <- mongodbconnect()
latest_timestamp = mongo_db$find(sort = '{"timestamp":-1}', limit=1)$timestamp[1]
latest_data = mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}')) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}'))
dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
))
# Connection to DB
source("mysql_connection.R")
# Establish connectiong to MySQL
con <- mysqldbconnect()
dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
))
latest_data = mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}')) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
latest_data
config <- config::get(file = "config.yml")
library(mongolite)
m <- mongo(collection = "Predictions",
db = 'TrafficBolzano',
url = config$mongodb)
# Libraries for data manipulation and visualization
library("shinythemes")
library("flexdashboard")
library("DBI")
library("dplyr")
library("ggplot2")
library("tidyverse")
library("shinyWidgets")
library("shiny")
library("plotly")
library("scales")
library("DT")
library("leaflet")
library("leaflet.extras")
library("maps")
library("rio")
# Connection to DB
source("mysql_connection.R")
library("RMariaDB")
# Establish connection to MySQL
con <- mysqldbconnect()
mongo_db <- mongodbconnect()
# Inserting token of mapbox for styling
mapboxToken <- config::get(file = "config.yml")$mapbox
Sys.setenv("MAPBOX_TOKEN" = mapboxToken)
latest_timestamp = mongo_db$find(sort = '{"timestamp":-1}', limit=1)$timestamp[1]
format(latest_timestamp,'%Y-%m-%d %H:%M:%S')
latest_timestamp
latest_timestamp
latest_data = mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}')) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
# Connection to DB
source("mysql_connection.R")
# Establish connection to MySQL
con <- mysqldbconnect()
mongo_db <- mongodbconnect()
latest_data = mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}')) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
latest_data
typeof(latest_DATA)
typeof(latest_DATA)
typeof(latest_data)
data.frame(latest_data)
typeof(data.frame(latest_data))
typeof(as.data.frame(latest_data))
as.data.frame(latest_data)
function (x, row.names = NULL, optional = FALSE, ...)
latest_data = as.data.frame(mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}')) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name")))
latest_data
View(latest_data)
latest_data = as.data.frame(mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}')) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name")))
# Connection to DB
source("mysql_connection.R")
# Establish connection to MySQL
con <- mysqldbconnect()
mongo_db <- mongodbconnect()
latest_data = as.data.frame(mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}')) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name")))
latest_data
typeof(latest_data)
typeof(as.data.frame(latest_data))
dbGetQuery(con, paste0(
"SELECT *
FROM bluetoothstations.station;"))
df = dbGetQuery(con, paste0(
"SELECT *
FROM bluetoothstations.station;"))
typeof(df)
# Libraries for data manipulation and visualization
library("shinythemes")
library("flexdashboard")
library("DBI")
library("dplyr")
library("ggplot2")
library("tidyverse")
library("shinyWidgets")
library("shiny")
library("plotly")
library("scales")
library("DT")
library("leaflet")
library("leaflet.extras")
library("maps")
library("rio")
# Connection to DB
source("mysql_connection.R")
library("RMariaDB")
# Establish connection to MySQL
con <- mysqldbconnect()
mongo_db <- mongodbconnect()
# Inserting token of mapbox for styling
mapboxToken <- config::get(file = "config.yml")$mapbox
Sys.setenv("MAPBOX_TOKEN" = mapboxToken)
now = Sys.Date()
now = Sys.Date()
now
format(now, "%Y-%m-%d %H:%M:%S")
Sys.time()
format(Sys.time(), "%Y-%m-%d %H:%M:%S")
mongo_db <- mongodbconnect()
now = format(Sys.time(), "%Y-%m-%d %H:%M:%S")
mongo_db$find(paste0('{timestamp: {$gt: ',now,'}}'),sort = '{"timestamp":-1}', limit=1)
mongo_db$find(paste0('{timestamp: {$gt: "',now,'"}}'),sort = '{"timestamp":-1}', limit=1)
mongo_db$find(paste0('{"timestamp": {$gt: "',now,'"}}'),sort = '{"timestamp":-1}', limit=1)
mongo_db$find(paste0('{"timestamp":{$gt: "',now,'"}}'),sort = '{"timestamp":-1}', limit=1)
mongo_db$find(
query = paste0('{"timestamp":{"$gt": "',now,'"}}'),
sort = '{"timestamp":-1}',
limit=1)$timestamp[1]
mongo_db$find(
query = paste0('{"timestamp":{"$gt": "',now,'"}}'),
sort = '{"timestamp":+1}',
limit=1)$timestamp[1]
mongo_db$find(
query = paste0('{"timestamp":{"$gt": "',now,'"}}'),
sort = '{"timestamp":1}',
limit=1)$timestamp[1]
data.frame(mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}')) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name")))
data.frame(mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}')) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name")))
# Establish connection to MySQL
con <- mysqldbconnect()
data.frame(mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}')) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name")))
mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}'
)
)
latest_timestamp = mongo_db$find(
query = paste0('{"timestamp":{"$gt": "',now,'"}}'),
sort = '{"timestamp":1}',
limit=1)$timestamp[1]
latest_timestamp
mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}'))
data.frame(mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}'))
)
mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}'))
data.frame(mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}'))) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
latest_data = data.frame(mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}'))) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
latest_data
typeof(latest_data)
View(latest_data)
data.frame(mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}'))) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
nrow(latest_data)
format(Sys.time(), "%Y-%m-%d %H:%M:%S")
mongo_db$find(
query = paste0('{"timestamp":{"$gt": "',now,'"}}'),
sort = '{"timestamp":1}',
limit=1)$timestamp[1]
now = format(Sys.time(), "%Y-%m-%d %H:%M:%S")
latest_timestamp = mongo_db$find(
query = paste0('{"timestamp":{"$gt": "',now,'"}}'),
sort = '{"timestamp":1}',
limit=1)$timestamp[1]
latest_timestamp
latest_data = data.frame(mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}'))
latest_data = data.frame(mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}')))
latest_data = data.frame(mongo_db$find(paste0('{"timestamp":"',latest_timestamp,'"}')))
latest_data
latest_data = data.frame(mongo_db$aggregate(paste0("[
{
'$match': {
'timestamp': '",latest_timestamp,"'
}
}, {
'$group': {
'_id': '$station',
'count': {
'$max': '$count'
}
}
}
]")))
data.frame(mongo_db$aggregate(paste0("[
{
'$match': {
'timestamp': '",latest_timestamp,"'
}
}, {
'$group': {
'_id': '$station',
'count': {'$max': '$count'}
}
}
]")))
latest_data = data.frame(mongo_db$aggregate(paste0("[
{
'$group': {
'_id': '$station',
'count': {'$max': '$count'}
}
}
]")))
latest_data = data.frame(mongo_db$aggregate(paste0("[
{
'$match': {
'timestamp': '",latest_timestamp,"'
}
}
]")))
"[
{
'$match': {
'timestamp': '",latest_timestamp,"'
}
}, {
'$group': {
'_id': '$station',
'count': {'$max': '$count'}
}
}
]"
latest_data = data.frame(mongo_db$aggregate(paste0("[
{
'$match': {
'timestamp': '2021-07-18 11:00:00'
}
}, {
'$group': {
'_id': '$station',
'count': {'$max': '$count'}
}
}
]")))
data.frame(mongo_db$aggregate(
'[{"$match": {"timestamp": "2021-07-18 11:00:00"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]'))
data.frame(mongo_db$aggregate(
'[{"$match": {"timestamp": "2021-07-18 11:00:00"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}},
{"$sort": {"station":-1}}]'))
latest_data = data.frame(mongo_db$aggregate(
'[{"$match": {"timestamp": "2021-07-18 11:00:00"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]')) %>%
arrange(-station)
latest_data = data.frame(mongo_db$aggregate(
'[{"$match": {"timestamp": "2021-07-18 11:00:00"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]')) %>%
arrange(desc(station))
data.frame(mongo_db$aggregate(
'[{"$match": {"timestamp": "2021-07-18 11:00:00"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]'))
latest_data = data.frame(mongo_db$aggregate(
'[{"$match": {"timestamp": "2021-07-18 11:00:00"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]')) %>%
arrange(desc(X_id))
View(latest_data)
data.frame(mongo_db$aggregate(
'[{"$match": {"timestamp": "2021-07-18 11:00:00"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]')) %>%
rename(station = X_id) %>%
arrange(station)
data.frame(mongo_db$aggregate(
'[{"$match": {"timestamp": "2021-07-18 11:00:00"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]')) %>%
rename(station = X_id) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
# Establish connection to MySQL
con <- mysqldbconnect()
mongo_db <- mongodbconnect()
now = format(Sys.time(), "%Y-%m-%d %H:%M:%S")
latest_timestamp = mongo_db$find(
query = paste0('{"timestamp":{"$gt": "',now,'"}}'),
sort = '{"timestamp":1}',
limit=1)$timestamp[1]
latest_data = data.frame(mongo_db$aggregate(
'[{"$match": {"timestamp": "2021-07-18 11:00:00"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]')) %>%
rename(station = X_id) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT * FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
latest_data
data.frame(mongo_db$aggregate(
'[{"$match": {"timestamp": "2021-07-18 11:00:00"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]')) %>%
rename(station = X_id) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT name, latitude, longitude FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
latest_data = data.frame(mongo_db$aggregate(
'[{"$match": {"timestamp": "2021-07-18 11:00:00"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]')) %>%
rename(station = X_id) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT name, latitude, longitude FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
latest_data = data.frame(mongo_db$aggregate(
'[{"$match": {"timestamp": "',latest_timestamp,'"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]')) %>%
rename(station = X_id) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT name, latitude, longitude FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
latest_data = data.frame(mongo_db$aggregate(paste0(
'[{"$match": {"timestamp": "',latest_timestamp,'"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]'))) %>%
rename(station = X_id) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT name, latitude, longitude FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
latest_data
latest_timestamp
mongo_db$find(
query = paste0('{"timestamp":{"$gt": "',"2021-07-19 00:00:00",'"}}'),
sort = '{"timestamp":1}',
limit=1)$timestamp[1]
latest_timestamp = mongo_db$find(
query = paste0('{"timestamp":{"$gt": "',"2021-07-19 00:00:00",'"}}'),
sort = '{"timestamp":1}',
limit=1)$timestamp[1]
latest_timestamp == NULL
is.null(latest_timestamp)
mongo_db$find(sort = '{"timestamp":-1}',
limit=1)$timestamp[1]
mongo_db <- mongodbconnect()
# Establish connection to MySQL
con <- mysqldbconnect()
now = format(Sys.time(), "%Y-%m-%d %H:%M:%S")
latest_timestamp = mongo_db$find(
query = paste0('{"timestamp":{"$gt": "',"2021-07-19 00:00:00",'"}}'),
sort = '{"timestamp":1}',
limit=1)$timestamp[1]
# In case latest data available is furthest than two hours ago
# and predictions are not available for this time or in the future
if(is.null(latest_timestamp)){
latest_timestamp = mongo_db$find(sort = '{"timestamp":-1}',
limit=1)$timestamp[1]
}
data.frame(mongo_db$aggregate(paste0(
'[{"$match": {"timestamp": "',latest_timestamp,'"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]'))) %>%
rename(station = X_id) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT name, latitude, longitude FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
data.frame(mongo_db$aggregate(paste0(
'[{"$match": {"timestamp": "',latest_timestamp,'"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]')))
latest_timestamp
now = format(Sys.time(), "%Y-%m-%d %H:%M:%S")
latest_timestamp = mongo_db$find(
query = paste0('{"timestamp":{"$gt": "',"2021-07-19 00:00:00",'"}}'),
sort = '{"timestamp":1}',
limit=1)$timestamp[1]
latest_timestamp
# In case latest data available is furthest than two hours ago
# and predictions are not available for this time or in the future
if(is.null(latest_timestamp)){
latest_timestamp = mongo_db$find(sort = '{"timestamp":-1}',
limit=1)$timestamp[1]
}
latest_timestamp
latest_timestamp = mongo_db$find(
query = paste0('{"timestamp":{"$gt": "',now,'"}}'),
sort = '{"timestamp":1}',
limit=1)$timestamp[1]
latest_timestamp
# In case latest data available is furthest than two hours ago
# and predictions are not available for this time or in the future
if(is.null(latest_timestamp)){
latest_timestamp = mongo_db$find(sort = '{"timestamp":-1}',
limit=1)$timestamp[1]
}
latest_timestamp
latest_data = data.frame(mongo_db$aggregate(paste0(
'[{"$match": {"timestamp": "',latest_timestamp,'"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]'))) %>%
rename(station = X_id) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT name, latitude, longitude FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
latest_data
latest_timestamp[1]
latest_timestamp
format(latest_timestamp)
format(latest_timestamp,"%Y-%m-%d %H:%M:%S")
print(latest_timestamp)
latest_timestamp
now = format(Sys.time(), "%Y-%m-%d %H:%M:%S")
latest_timestamp = mongo_db$find(
query = paste0('{"timestamp":{"$gt": "',now,'"}}'),
sort = '{"timestamp":1}',
limit=1)$timestamp[1]
latest_data = data.frame(mongo_db$aggregate(paste0(
'[{"$match": {"timestamp": "',latest_timestamp,'"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]'))) %>%
rename(station = X_id) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT name, latitude, longitude FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
# Establish connection to MySQL
con <- mysqldbconnect()
mongo_db <- mongodbconnect()
latest_data = data.frame(mongo_db$aggregate(paste0(
'[{"$match": {"timestamp": "',latest_timestamp,'"}},
{"$group": {"_id": "$station", "count": {"$max": "$count"}}}]'))) %>%
rename(station = X_id) %>%
inner_join(dbGetQuery(con, paste0(
"SELECT name, latitude, longitude FROM bluetoothstations.station
WHERE latitude IS NOT NULL and longitude IS NOT NULL;"
)),by = c("station"="name"))
latest_data
